<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <title>MIRENA PRO v17.0 - Stealth Master</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --neon: #00ff41; --dark: #0a0a0a; --gray: #1a1a1a; --gold: #ffcc00; }
        body { margin: 0; background: var(--dark); color: #fff; font-family: 'Consolas', monospace; overflow: hidden; }
        
        .master-grid { display: grid; grid-template-columns: 350px 1fr; height: 100vh; }
        
        /* Paneli i Kontrollit */
        .sidebar { background: #000; border-right: 1px solid var(--neon); padding: 25px; display: flex; flex-direction: column; gap: 20px; box-shadow: 10px 0 30px rgba(0,255,65,0.05); }
        .sidebar h1 { color: var(--neon); font-size: 22px; margin-bottom: 20px; text-shadow: 0 0 10px var(--neon); }
        
        .control-group { background: var(--gray); padding: 15px; border: 1px solid #333; border-radius: 4px; }
        label { display: block; font-size: 10px; color: var(--neon); margin-bottom: 8px; text-transform: uppercase; }
        input { width: 100%; background: #000; border: 1px solid #444; color: var(--neon); padding: 10px; box-sizing: border-box; font-size: 16px; border-radius: 3px; }
        input:focus { border-color: var(--neon); outline: none; }

        /* Hapësira e Punës */
        .workspace { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Print Area */
        #print-area { flex: 1; background: #fff; color: #000; padding: 40px; overflow-y: auto; font-family: 'Segoe UI', sans-serif; }
        .table-title { background: #000; color: var(--neon); padding: 12px; font-weight: bold; margin: 20px 0 10px 0; border-left: 10px solid var(--neon); }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px; }
        th { background: #f0f0f0; border: 1px solid #ccc; padding: 10px; text-align: left; text-transform: uppercase; }
        td { border: 1px solid #ddd; padding: 8px; }
        .highlight-row { background: #f9f9f9; font-weight: bold; }

        /* 3D Visual */
        .visual-panel { flex: 0.8; background: radial-gradient(circle, #1a1a1a, #000); position: relative; display: flex; align-items: center; justify-content: center; border-top: 1px solid #333; cursor: move; }
        .world { transform-style: preserve-3d; transition: 0.1s; }
        .muri { display: flex; align-items: flex-end; gap: 10px; transform-style: preserve-3d; }
        
        .box-unit { border: 1px solid var(--neon); background: rgba(0, 255, 65, 0.05); position: relative; transform-style: preserve-3d; }
        .box-unit::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,255,65,0.1), transparent); }

        .btn-neon { background: transparent; border: 1px solid var(--neon); color: var(--neon); padding: 15px; cursor: pointer; font-weight: bold; transition: 0.3s; text-transform: uppercase; }
        .btn-neon:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

<div class="master-grid">
    <div class="sidebar">
        <h1>MIRENA PRO v17</h1>
        
        <div class="control-group">
            <label>Gjatësia e Murit (cm)</label>
            <input type="number" id="k_w" value="500" oninput="kalkulo()">
        </div>
        
        <div class="control-group">
            <label>Lartësia (cm)</label>
            <input type="number" id="k_h" value="230" oninput="kalkulo()">
        </div>

        <div class="control-group">
            <label>Trashësia e Ivericës (mm)</label>
            <input type="number" id="iv_mm" value="18" oninput="kalkulo()">
        </div>

        <button class="btn-neon" onclick="shkarkoPDF()">Gjenero Dokumentin PDF</button>
        
        <div id="quick-stats" style="margin-top: auto; font-size: 11px; color: #666;">
            Sistemi i llogaritjes: Master v17.0.1<br>
            Statusi: Gati për prerje
        </div>
    </div>

    <div class="workspace">
        <div id="print-area">
            <div id="render-list"></div>
        </div>
        
        <div class="visual-panel" id="viewport">
            <div class="world" id="world">
                <div id="vizatimi-3d" class="muri"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function kalkulo() {
        const W = parseFloat(document.getElementById('k_w').value) || 0;
        const H = parseFloat(document.getElementById('k_h').value) || 230;
        const t = (parseFloat(document.getElementById('iv_mm').value) || 18) / 10;
        
        const renderList = document.getElementById('render-list');
        const v3d = document.getElementById('vizatimi-3d');
        renderList.innerHTML = ""; v3d.innerHTML = "";

        let modules = [
            { emri: "Frigoriferi", w: 64, type: "tall" },
            { emri: "Enëlarësja", w: 60, type: "base" },
            { emri: "Furra", w: 60, type: "base" }
        ];

        let rw = W - 184;
        while(rw >= 60) { modules.push({ emri: "Dollap Std", w: 60, type: "base" }); rw -= 60; }
        if(rw > 5) modules.push({ emri: "Mbyllja", w: rw, type: "base" });

        let tablesHtml = `<h1 style="text-align:center; color:#000;">PLANPROJEKTI I PRODHIMIT</h1>`;

        // 1. TABELA E IVERICËS
        tablesHtml += `<div class="table-title">1. LISTA E PRERJES: IVERICË (18mm)</div>
                       <table><thead><tr><th>Moduli</th><th>Pjesa</th><th>Dimensioni</th><th>Cope</th><th>Kantimi</th></tr></thead><tbody>`;

        modules.forEach(m => {
            let col = document.createElement('div');
            col.className = 'column'; col.style.width = (m.w * 1.2) + 'px'; col.style.transformStyle = 'preserve-3d';

            if(m.type === "tall") {
                tablesHtml += `<tr class="highlight-row"><td colspan="5">${m.emri}</td></tr>
                <tr><td>-</td><td>Anësore</td><td>${H} x 56</td><td>2</td><td>Para+Lart</td></tr>
                <tr><td>-</td><td>Tavan/Fund</td><td>${(m.w - t*2).toFixed(1)} x 56</td><td>2</td><td>Para</td></tr>`;
                
                let b = document.createElement('div'); b.className = 'box-unit'; b.style.height = (H*1.2)+'px'; b.style.width = (m.w*1.2)+'px';
                col.appendChild(b);
            } else {
                let labelUp = (m.emri === "Enëlarësja" || m.emri === "Furra") ? "Dollapi Lart" : m.emri + " Lart";
                tablesHtml += `<tr class="highlight-row"><td colspan="5">${labelUp}</td></tr>
                <tr><td>Lart</td><td>Anësore</td><td>72 x 32</td><td>2</td><td>Para+Poshtë</td></tr>
                <tr><td>Lart</td><td>Fund/Tavan</td><td>${(m.w - t*2).toFixed(1)} x 32</td><td>2</td><td>Para</td></tr>`;
                
                if(m.emri !== "Enëlarësja") {
                    tablesHtml += `<tr class="highlight-row"><td colspan="5">${m.emri} Poshtë</td></tr>
                    <tr><td>Poshtë</td><td>Anësore</td><td>72 x 56</td><td>2</td><td>Para</td></tr>
                    <tr><td>Poshtë</td><td>Fund</td><td>${(m.w - t*2).toFixed(1)} x 56</td><td>1</td><td>Para</td></tr>`;
                }

                let bUp = document.createElement('div'); bUp.className = 'box-unit'; bUp.style.height = '86.4px'; bUp.style.width = (m.w*1.2)+'px';
                let bMid = document.createElement('div'); bMid.style.height = '40px';
                let bDown = document.createElement('div'); bDown.className = 'box-unit'; bDown.style.height = '86.4px'; bDown.style.width = (m.w*1.2)+'px';
                col.appendChild(bUp); col.appendChild(bMid); col.appendChild(bDown);
            }
            v3d.appendChild(col);
        });
        tablesHtml += `</tbody></table>`;

        // 2. TABELA E BALLOREVE
        tablesHtml += `<div class="table-title">2. LISTA E BALLOREVE (DYERT)</div>
                       <table><thead><tr><th>Pozicioni</th><th>L x Gj (cm)</th><th>Cope</th><th>Mentesha</th></tr></thead><tbody>`;
        modules.forEach(m => {
            if(m.type === "tall") {
                tablesHtml += `<tr><td>${m.emri} Full</td><td>${(H-0.4).toFixed(1)} x ${(m.w-0.4).toFixed(1)}</td><td>1</td><td>5</td></tr>`;
            } else {
                tablesHtml += `<tr><td>${m.emri} Lart</td><td>71.6 x ${(m.w-0.4).toFixed(1)}</td><td>1</td><td>2</td></tr>
                               <tr><td>${m.emri} Poshtë</td><td>71.6 x ${(m.w-0.4).toFixed(1)}</td><td>1</td><td>2</td></tr>`;
            }
        });
        tablesHtml += `</tbody></table>`;

        renderList.innerHTML = tablesHtml;
    }

    // Interactive 3D Rotation
    let rY = -20;
    const viewport = document.getElementById('viewport');
    viewport.onmousedown = (e) => {
        document.onmousemove = (ev) => {
            rY += ev.movementX * 0.5;
            document.getElementById('world').style.transform = `rotateX(-15deg) rotateY(${rY}deg)`;
        };
    };
    document.onmouseup = () => document.onmousemove = null;

    function shkarkoPDF() {
        const opt = { margin: 10, filename: 'Mirena_Stealth_v17.pdf', jsPDF: { orientation: 'portrait' } };
        html2pdf().from(document.getElementById('print-area')).set(opt).save();
    }
    
    kalkulo();
</script>
</body>
</html>
